var GSVPANO=GSVPANO||{};
GSVPANO.PanoLoader=function(l){var b=l.zoom||1,k,m=new google.maps.StreetViewService,g=0,i=0,h=document.createElement("canvas"),n=h.getContext("2d");this.setProgress=function(a){if(this.onProgress)this.onProgress(a)};this.throwError=function(a){if(this.onError)this.onError(a);else console.error(a)};this.adaptTextureToZoom=function(){var a=416*Math.pow(2,b),c=416*Math.pow(2,b-1);h.width=a;h.height=c};this.composeFromTile=function(a,c,j){n.drawImage(j,512*a,512*c);g++;this.setProgress(Math.round(100*g/
i));if(g===i&&(this.canvas=h,this.onPanoramaLoad))this.onPanoramaLoad()};this.composePanorama=function(){this.setProgress(0);console.log("Loading panorama for zoom "+b+"...");var a=Math.pow(2,b),c=Math.pow(2,b-1),j=this,d,e,f;g=0;i=a*c;for(f=0;f<c;f++)for(e=0;e<a;e++)d="http://maps.google.com/cbk?output=tile&panoid="+k+"&zoom="+b+"&x="+e+"&y="+f+"&"+Date.now(),function(a,c){var b=new Image;b.addEventListener("load",function(){j.composeFromTile(a,c,this)});b.crossOrigin="";b.src=d}(e,f)};this.load=
function(a){console.log("Load for",a);this.location=a;var c=this;m.getPanoramaByLocation(a,50,function(b,d){d===google.maps.StreetViewStatus.OK?(google.maps.geometry.spherical.computeHeading(a,b.location.latLng),c.copyright=b.copyright,k=b.location.pano,c.composePanorama()):c.throwError("Could not retrieve panorama for the following reason: "+d)})};this.adaptTextureToZoom()};
